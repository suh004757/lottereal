<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ë¦¬í¬íŠ¸ í¸ì§‘ê¸° | ë¡¯ë°ë¶€ë™ì‚° ê´€ë¦¬ì</title>
    <link rel="icon" href="../img/core-img/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../css/insights.css">

    <!-- SimpleMDE Markdown Editor -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>

    <style>
        .admin-editor {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .editor-header {
            background: #1e293b;
            color: #ffffff;
            padding: 2rem;
            border-radius: 1rem 1rem 0 0;
            margin-bottom: 0;
        }

        .editor-body {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 1rem 1rem;
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-textarea {
            min-height: 100px;
            font-family: inherit;
            resize: vertical;
        }

        .editor-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #e5e7eb;
        }

        .btn-save {
            background: #10b981;
            color: #ffffff;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-save:hover {
            background: #059669;
        }

        .btn-preview {
            background: #3b82f6;
            color: #ffffff;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-preview:hover {
            background: #2563eb;
        }

        .btn-cancel {
            background: #6b7280;
            color: #ffffff;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-cancel:hover {
            background: #4b5563;
        }

        .evidence-editor {
            background: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }

        .evidence-item {
            background: #ffffff;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
        }

        .evidence-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .btn-remove {
            background: #ef4444;
            color: #ffffff;
            padding: 0.25rem 0.75rem;
            border: none;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .btn-add {
            background: #10b981;
            color: #ffffff;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
        }

        .preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 2rem;
            overflow-y: auto;
        }

        .preview-content {
            background: #ffffff;
            border-radius: 1rem;
            max-width: 1000px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 3rem;
        }

        .preview-close {
            position: sticky;
            top: 0;
            right: 0;
            background: #ef4444;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            float: right;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <div class="admin-editor">
        <div class="editor-header">
            <h1>ğŸ¤– AI ì‹œì¥ íŠ¸ë Œë“œ ë¦¬í¬íŠ¸ í¸ì§‘ê¸°</h1>
            <p style="margin-top: 0.5rem; opacity: 0.8; margin-bottom: 0;">ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”. ë¯¸ë¦¬ë³´ê¸°ë¡œ í™•ì¸ í›„ ë°œí–‰í•˜ì„¸ìš”.</p>
        </div>

        <div class="editor-body">
            <!-- Basic Info -->
            <div class="form-group">
                <label class="form-label" for="report-title">ë¦¬í¬íŠ¸ ì œëª© *</label>
                <input type="text" id="report-title" class="form-input" placeholder="ì˜ˆ: 2025ë…„ 1ì›” ì„œìš¸ ë¶€ë™ì‚° ì‹œì¥ íŠ¸ë Œë“œ ë¦¬í¬íŠ¸"
                    value="2025ë…„ 1ì›” ì„œìš¸ ë¶€ë™ì‚° ì‹œì¥ íŠ¸ë Œë“œ ë¦¬í¬íŠ¸">
            </div>

            <div class="form-group">
                <label class="form-label" for="report-slug">URL ìŠ¬ëŸ¬ê·¸ *</label>
                <input type="text" id="report-slug" class="form-input" placeholder="ì˜ˆ: 2025-01-market-report"
                    value="2025-01-market-report">
                <small style="color: #6b7280; font-size: 0.875rem;">URL: https://lottes.co.kr/report/{slug}</small>
            </div>

            <div class="form-group">
                <label class="form-label" for="report-summary">ìš”ì•½ (í•œ ì¤„) *</label>
                <textarea id="report-summary" class="form-input form-textarea"
                    placeholder="ë¦¬í¬íŠ¸ì˜ í•µì‹¬ ë‚´ìš©ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•˜ì„¸ìš”">ì„œìš¸ ì£¼ìš” ì§€ì—­ì˜ ì‹¤ê±°ë˜ ë°ì´í„°, ì •ì±… ë³€í™”, ì‹œì¥ ì‹ í˜¸ë¥¼ ì¢…í•© ë¶„ì„í•œ ì°¸ê³  ìë£Œì…ë‹ˆë‹¤.</textarea>
            </div>

            <!-- Markdown Editor -->
            <div class="form-group">
                <label class="form-label" for="report-content">ë¦¬í¬íŠ¸ ë³¸ë¬¸ (Markdown) *</label>
                <textarea id="report-content"></textarea>
                <small style="color: #6b7280; font-size: 0.875rem;">
                    <strong>ê¶Œì¥ êµ¬ì¡°:</strong> 1) ê±°ì‹œ í™˜ê²½, 2) ìˆ˜ìš”/ê³µê¸‰, 3) ê°€ê²© ë™í–¥, 4) ë¦¬ìŠ¤í¬ ê´€ì°°, 5) ì£¼ëª©í•  ì‹ í˜¸
                </small>
            </div>

            <!-- Evidence Sources -->
            <div class="form-group">
                <label class="form-label">ë°ì´í„° ì¶œì²˜ ë° ê·¼ê±°</label>
                <div class="evidence-editor" id="evidence-container">
                    <!-- Will be populated by JS -->
                </div>
                <button class="btn-add" onclick="addEvidenceSource()">+ ì¶œì²˜ ì¶”ê°€</button>
            </div>

            <!-- Status -->
            <div class="form-group">
                <label class="form-label" for="report-status">ë°œí–‰ ìƒíƒœ *</label>
                <select id="report-status" class="form-input">
                    <option value="draft">ì„ì‹œ ì €ì¥ (Draft)</option>
                    <option value="published">ë°œí–‰ (Published)</option>
                </select>
            </div>

            <!-- Actions -->
            <div class="editor-actions">
                <button class="btn-cancel" onclick="window.location.href='dashboard.html'">ì·¨ì†Œ</button>
                <button class="btn-preview" onclick="showPreview()">ë¯¸ë¦¬ë³´ê¸°</button>
                <button class="btn-save" onclick="saveReport()">ì €ì¥ ë° ë°œí–‰</button>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="preview-modal">
        <div class="preview-content">
            <button class="preview-close" onclick="closePreview()">âœ• ë‹«ê¸°</button>
            <div id="preview-body"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script>
        // Initialize SimpleMDE
        const simplemde = new SimpleMDE({
            element: document.getElementById('report-content'),
            spellChecker: false,
            placeholder: 'ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”...\n\n## 1. ê±°ì‹œ í™˜ê²½ (Macro)\n\n### ê¸ˆë¦¬ ë° ì •ì±… ë™í–¥\n\n...',
            minHeight: '500px',
            toolbar: [
                'bold', 'italic', 'heading', '|',
                'quote', 'unordered-list', 'ordered-list', '|',
                'link', 'image', '|',
                'preview', 'side-by-side', 'fullscreen', '|',
                'guide'
            ]
        });

        // Sample template
        const SAMPLE_TEMPLATE = `## 1. ê±°ì‹œ í™˜ê²½ (Macro)

### ê¸ˆë¦¬ ë° ì •ì±… ë™í–¥

ìµœê·¼ 3ê°œì›”ê°„ í•œêµ­ì€í–‰ ê¸°ì¤€ê¸ˆë¦¬ëŠ” **ë™ê²°**ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤...

### ì‹ ìš© ë° ëŒ€ì¶œ í™˜ê²½

ì£¼íƒë‹´ë³´ëŒ€ì¶œ ê¸ˆë¦¬ëŠ” í‰ê·  **ì—° X~Y%** ìˆ˜ì¤€ìœ¼ë¡œ ê´€ì°°ë©ë‹ˆë‹¤...

---

## 2. ìˆ˜ìš” ë° ê³µê¸‰ (Demand/Supply)

### ê±°ë˜ëŸ‰ ë™í–¥

ì„œìš¸ ì „ì²´ ì•„íŒŒíŠ¸ ê±°ë˜ëŸ‰ì€ ì „ì›” ëŒ€ë¹„ **ì•½ X% ë³€í™”**í•œ ê²ƒìœ¼ë¡œ ì§‘ê³„ë˜ì—ˆìŠµë‹ˆë‹¤...

### ê³µê¸‰ ì‹ í˜¸

ì‹ ê·œ ë¶„ì–‘ ë¬¼ëŸ‰ì€...

---

## 3. ê°€ê²© ë™í–¥ (Price Action)

### í•µì‹¬ ì§€ì—­ (Core)

ê°•ë‚¨, ì†¡íŒŒ, ì„œì´ˆ ë“± í•µì‹¬ ì§€ì—­ì˜ ë§¤ë§¤ê°€ëŠ”...

### ë¹„í•µì‹¬ ì§€ì—­ (Non-Core)

ë¹„ê°•ë‚¨ê¶Œì˜ ë§¤ë§¤ê°€ëŠ”...

---

## 4. ë¦¬ìŠ¤í¬ ê´€ì°° (Risk Watchlist)

### ë‹¨ê¸° ë¦¬ìŠ¤í¬

1. **ê¸ˆë¦¬ ë³€ë™**: ...
2. **ì •ì±… ë³€í™”**: ...

### ì¤‘ì¥ê¸° ë¦¬ìŠ¤í¬

1. **ì¸êµ¬ êµ¬ì¡°**: ...
2. **ê³µê¸‰ ê³¼ì‰**: ...

---

## 5. ì£¼ëª©í•  ì‹ í˜¸ (What to Watch Next)

### ë‹¤ìŒ ë‹¬ ê´€ì°° í¬ì¸íŠ¸

- í•œêµ­ì€í–‰ ê¸ˆí†µìœ„ ê²°ê³¼
- ì‹ ê·œ ë¶„ì–‘ ì²­ì•½ ê²½ìŸë¥ 
- ì „ì„¸ â†’ ì›”ì„¸ ì „í™˜ìœ¨

---

## ë§ˆë¬´ë¦¬

ë³¸ ë¦¬í¬íŠ¸ëŠ” ê³¼ê±° ë°ì´í„°ì˜ ê´€ì°° ë° í•´ì„ì´ë©°, ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•˜ê±°ë‚˜ íˆ¬ìë¥¼ ê¶Œìœ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
`;

        // Initialize with sample template
        simplemde.value(SAMPLE_TEMPLATE);

        // Evidence sources management
        let evidenceSources = [
            {
                name: 'êµ­í† êµí†µë¶€ ì‹¤ê±°ë˜ê°€ ê³µê°œì‹œìŠ¤í…œ',
                url: 'https://rt.molit.go.kr',
                coverage: 'ì„œìš¸ ì „ì—­ ì•„íŒŒíŠ¸ ì‹¤ê±°ë˜ ë°ì´í„°'
            }
        ];

        function renderEvidenceSources() {
            const container = document.getElementById('evidence-container');
            container.innerHTML = evidenceSources.map((source, index) => `
        <div class="evidence-item">
          <div class="evidence-item-header">
            <strong>ì¶œì²˜ ${index + 1}</strong>
            <button class="btn-remove" onclick="removeEvidenceSource(${index})">ì‚­ì œ</button>
          </div>
          <div class="form-group" style="margin-bottom: 0.5rem;">
            <input type="text" class="form-input" placeholder="ì¶œì²˜ ì´ë¦„" value="${source.name}" onchange="updateEvidenceSource(${index}, 'name', this.value)">
          </div>
          <div class="form-group" style="margin-bottom: 0.5rem;">
            <input type="url" class="form-input" placeholder="URL" value="${source.url}" onchange="updateEvidenceSource(${index}, 'url', this.value)">
          </div>
          <div class="form-group" style="margin-bottom: 0;">
            <input type="text" class="form-input" placeholder="ë°ì´í„° ë²”ìœ„ (ì˜ˆ: ì„œìš¸ ì „ì—­ ì•„íŒŒíŠ¸ ì‹¤ê±°ë˜ ë°ì´í„°)" value="${source.coverage}" onchange="updateEvidenceSource(${index}, 'coverage', this.value)">
          </div>
        </div>
      `).join('');
        }

        function addEvidenceSource() {
            evidenceSources.push({ name: '', url: '', coverage: '' });
            renderEvidenceSources();
        }

        function removeEvidenceSource(index) {
            evidenceSources.splice(index, 1);
            renderEvidenceSources();
        }

        function updateEvidenceSource(index, field, value) {
            evidenceSources[index][field] = value;
        }

        // Preview
        function showPreview() {
            const title = document.getElementById('report-title').value;
            const content = simplemde.value();
            const html = marked.parse(content);

            const previewBody = document.getElementById('preview-body');
            previewBody.innerHTML = `
        <h1 style="font-size: 2.5rem; margin-bottom: 1rem; color: #111827;">${title}</h1>
        <div class="lr-report-body">${html}</div>
      `;

            document.getElementById('preview-modal').style.display = 'flex';
        }

        function closePreview() {
            document.getElementById('preview-modal').style.display = 'none';
        }

        // Save (Mock - will connect to Supabase later)
        function saveReport() {
            const report = {
                title: document.getElementById('report-title').value,
                slug: document.getElementById('report-slug').value,
                summary: document.getElementById('report-summary').value,
                content: simplemde.value(),
                evidence: evidenceSources,
                status: document.getElementById('report-status').value,
                updated_at: new Date().toISOString()
            };

            console.log('Saving report:', report);
            alert('âœ“ ë¦¬í¬íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì‹¤ì œ ì €ì¥ì€ Supabase ì—°ë™ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤.');

            // TODO: Connect to Supabase
            // await supabase.from('market_reports').insert([report]);
        }

        // Initialize
        renderEvidenceSources();
    </script>
</body>

</html>